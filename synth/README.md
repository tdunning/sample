# Generating Synthetic Power Data 

This directory contains code for generating synthetic power data including both the actual data as well as an inventory of the devices generating the data. The only trick to this is that there is a lot of internal coherency that is required to make this data look reasonable. First, the data as generated should always refer to machines in the inventory, second the inventory should have realistic machine information and location information.

# Process Description

The general process here starts with a catalog of machine types. This catalog (or inventory) is generated by constructing serial numbers and selecting server types and locations all at random.

To make the result be realistic, I grabbed about 20 machine definitions from the (HPE Partsurfer)[https://partsurfer.hpe.com/] to get this going (it's easy to add more later) and put the results into `server_types.csv`. There are also also several locations listed in `locations.csv`.

The random numbers are used to join against server types and locations to build an inventory of whatever size is desired.

Once we have an inventory of servers, we need to create measurements for each server, at each time point, for each kind of measurement. The core idea is that the measurements are a cartesian join with the inventory, the sample times and the measurement types (`measurements.csv`). This results in one sample for each combination of machine in inventory, time and measurement type. These samples are augmented with a random number in the range [0,1] scaled by the reasonable max in `measurements.csv`. 

# Running the Generator

You can do the entire data generation programatically using the `generate-inventory` and `generate-data` scripts.

## Inventory Generation

Inventory generation only needs to be done once for an output directory. The options for this script include:

| Option            | Description    |
| ----------- | ----------  |
| `--directory` | The directory where the inventory should be written |
| `--count`      | The number of servers for which data should be generatyed |

Creating an inventory will also create a template `README` file in the target directory. The metadata in the header of the README file contains a synthesized GLCP user ID.

## Data Generation

Data generation can be done once or multiple times to generate multiple output files.

The command line options include the following

| Option            | Description   |
| ----------- | ---------   |
| `--directory` | The directory where the data should be written |
| `--date`        | the base time in the format YYYY-MM-DD or YYYY-MM-DDTHH |
| `--interval`   | the interval between measurements in seconds. The default is 3600 (1 hour) |
| `--fuzz`        | the maximum variation in time between samples. Default is 0 |
| `--interval`   | specifies that beginning and end times for each measurement are included in the output. This is the default. |
| `--end`         | specifies that only the end time for each measurement is included. This is an alternative to`--interval` |
| `--format=f` | specifies the output format for the data. The value of f can be csv or parquet |

Note that if you specify the base time with an hour, only an hour of data will be generated. If you specify a date with no time, then 24 hours of data will be generated.

Note also that the `--fuzz`, `--end` and `--format` options are not yet supported.
